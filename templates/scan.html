<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Attendance">
    <meta name="theme-color" content="#667eea">
    <title>Mark Attendance</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="apple-touch-icon" href="/static/icon-192.png">
</head>
<body>
    <div class="container">
        <h1>üì≤ Student Attendance Scan</h1>
        <p class="subtitle">Enter your student ID and the token from the QR code</p>

        {% if success %}
        <div class="alert alert-success">
            {{ success }}
        </div>
        {% endif %}

        {% if error %}
        <div class="alert alert-error">
            {{ error }}
        </div>
        {% endif %}

        <div class="form-container">
            <form method="post">
                <input 
                    type="text" 
                    name="student_id" 
                    placeholder="Enter your Student ID" 
                    required 
                    autofocus
                    value="{{ student_id if student_id else '' }}"
                ><br>
                <input 
                    type="text" 
                    name="token" 
                    placeholder="Enter 6-digit token from QR" 
                    required
                    maxlength="6"
                    pattern="\d{6}"
                    value="{{ token if token else '' }}"
                ><br>
                <button type="submit" class="btn">‚úì Mark Attendance</button>
            </form>
        </div>

        <div style="text-align: center; margin-top: 30px; color: #666;">
            <p><strong>Instructions:</strong></p>
            <p>1. Scan the QR code displayed on the main screen</p>
            <p>2. Enter the 6-digit token number</p>
            <p>3. Enter your student ID</p>
            <p>4. Submit to mark your attendance</p>
        </div>

        <div class="nav-buttons">
            <a href="/">‚Üê Back to Home</a>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/service-worker.js')
                .then(() => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed:', err));
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            const installBanner = document.createElement('div');
            installBanner.className = 'alert alert-success';
            installBanner.style.cursor = 'pointer';
            installBanner.innerHTML = 'üì± Install this app on your phone for quick access! Tap here.';
            installBanner.onclick = async () => {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBanner.remove();
                }
                deferredPrompt = null;
            };
            
            document.querySelector('.container').insertBefore(installBanner, document.querySelector('h1'));
        });
    </script>
</body>
</html>
